<?xml version='1.0' encoding='UTF-8'?>
<project>
  <actions/>
  <description></description>
  <keepDependencies>false</keepDependencies>
  <properties>
    <hudson.plugins.buildblocker.BuildBlockerProperty plugin="build-blocker-plugin@1.7.3">
      <useBuildBlocker>true</useBuildBlocker>
      <blockLevel>NODE</blockLevel>
      <scanQueueFor>DISABLED</scanQueueFor>
      <blockingJobs>.*Listener</blockingJobs>
    </hudson.plugins.buildblocker.BuildBlockerProperty>
    <hudson.model.ParametersDefinitionProperty>
      <parameterDefinitions>
        <hudson.model.StringParameterDefinition>
          <name>JENKINS_USERNAME</name>
          <description>This Jenkins user that is calling the IRODS Listener job.</description>
          <defaultValue>wrkspuser</defaultValue>
        </hudson.model.StringParameterDefinition>
        <hudson.model.StringParameterDefinition>
          <name>JENKINS_USER_PASSWORD</name>
          <description>The password/token belonging to the Jenkins user calling the IRODS Listener job</description>
          <defaultValue></defaultValue>
        </hudson.model.StringParameterDefinition>
        <hudson.model.StringParameterDefinition>
          <name>JENKINS_JOB_URL</name>
          <description>The URL for the IRODS Listener job</description>
          <defaultValue>http://wij.vm:9171/job/IrodsListener/buildWithParameters</defaultValue>
        </hudson.model.StringParameterDefinition>
        <hudson.model.StringParameterDefinition>
          <name>JENKINS_JOB_TOKEN</name>
          <description>The API token for the IRODS Listener Job</description>
          <defaultValue></defaultValue>
        </hudson.model.StringParameterDefinition>
        <hudson.model.StringParameterDefinition>
          <name>MODE</name>
          <description>Indicates whether the mode of operation is development (DEV) or other.  If not development, a complete cleaning is done.</description>
          <defaultValue>Dev</defaultValue>
        </hudson.model.StringParameterDefinition>
      </parameterDefinitions>
    </hudson.model.ParametersDefinitionProperty>
  </properties>
  <scm class="hudson.scm.SubversionSCM" plugin="subversion@2.7.1">
    <locations>
      <hudson.scm.SubversionSCM_-ModuleLocation>
        <remote>https://www.cbil.upenn.edu/svn/gus/install/trunk</remote>
        <credentialsId></credentialsId>
        <local>project_home/install</local>
        <depthOption>infinity</depthOption>
        <ignoreExternalsOption>false</ignoreExternalsOption>
      </hudson.scm.SubversionSCM_-ModuleLocation>
      <hudson.scm.SubversionSCM_-ModuleLocation>
        <remote>https://www.cbil.upenn.edu/svn/gus/WSF/trunk</remote>
        <credentialsId></credentialsId>
        <local>project_home/WSF</local>
        <depthOption>infinity</depthOption>
        <ignoreExternalsOption>false</ignoreExternalsOption>
      </hudson.scm.SubversionSCM_-ModuleLocation>
      <hudson.scm.SubversionSCM_-ModuleLocation>
        <remote>https://www.cbil.upenn.edu/svn/apidb/ApiCommonData/trunk</remote>
        <credentialsId></credentialsId>
        <local>project_home/ApiCommonData</local>
        <depthOption>infinity</depthOption>
        <ignoreExternalsOption>false</ignoreExternalsOption>
      </hudson.scm.SubversionSCM_-ModuleLocation>
      <hudson.scm.SubversionSCM_-ModuleLocation>
        <remote>https://www.cbil.upenn.edu/svn/apidb/EuPathSiteCommon/trunk</remote>
        <credentialsId></credentialsId>
        <local>project_home/EuPathSiteCommon</local>
        <depthOption>infinity</depthOption>
        <ignoreExternalsOption>false</ignoreExternalsOption>
      </hudson.scm.SubversionSCM_-ModuleLocation>
      <hudson.scm.SubversionSCM_-ModuleLocation>
        <remote>https://www.cbil.upenn.edu/svn/apidb/DoTS/trunk</remote>
        <credentialsId></credentialsId>
        <local>project_home/DoTS</local>
        <depthOption>infinity</depthOption>
        <ignoreExternalsOption>false</ignoreExternalsOption>
      </hudson.scm.SubversionSCM_-ModuleLocation>
      <hudson.scm.SubversionSCM_-ModuleLocation>
        <remote>https://www.cbil.upenn.edu/svn/gus/TuningManager/trunk</remote>
        <credentialsId></credentialsId>
        <local>project_home/TuningManager</local>
        <depthOption>infinity</depthOption>
        <ignoreExternalsOption>false</ignoreExternalsOption>
      </hudson.scm.SubversionSCM_-ModuleLocation>
      <hudson.scm.SubversionSCM_-ModuleLocation>
        <remote>https://www.cbil.upenn.edu/svn/gus/GusAppFramework/trunk</remote>
        <credentialsId></credentialsId>
        <local>project_home/GUS</local>
        <depthOption>infinity</depthOption>
        <ignoreExternalsOption>false</ignoreExternalsOption>
      </hudson.scm.SubversionSCM_-ModuleLocation>
      <hudson.scm.SubversionSCM_-ModuleLocation>
        <remote>https://www.cbil.upenn.edu/svn/gus/CBIL/trunk</remote>
        <credentialsId></credentialsId>
        <local>project_home/CBIL</local>
        <depthOption>infinity</depthOption>
        <ignoreExternalsOption>false</ignoreExternalsOption>
      </hudson.scm.SubversionSCM_-ModuleLocation>
      <hudson.scm.SubversionSCM_-ModuleLocation>
        <remote>https://www.cbil.upenn.edu/svn/gus/GusSchema/trunk</remote>
        <credentialsId></credentialsId>
        <local>project_home/GusSchema</local>
        <depthOption>infinity</depthOption>
        <ignoreExternalsOption>false</ignoreExternalsOption>
      </hudson.scm.SubversionSCM_-ModuleLocation>
      <hudson.scm.SubversionSCM_-ModuleLocation>
        <remote>https://www.cbil.upenn.edu/svn/apidb/ApiCommonWebService/trunk</remote>
        <credentialsId></credentialsId>
        <local>project_home/ApiCommonWebService</local>
        <depthOption>infinity</depthOption>
        <ignoreExternalsOption>false</ignoreExternalsOption>
      </hudson.scm.SubversionSCM_-ModuleLocation>
      <hudson.scm.SubversionSCM_-ModuleLocation>
        <remote>https://www.cbil.upenn.edu/svn/apidb/ApiCommonWebsite/trunk</remote>
        <credentialsId></credentialsId>
        <local>project_home/ApiCommonWebsite</local>
        <depthOption>infinity</depthOption>
        <ignoreExternalsOption>false</ignoreExternalsOption>
      </hudson.scm.SubversionSCM_-ModuleLocation>
      <hudson.scm.SubversionSCM_-ModuleLocation>
        <remote>https://www.cbil.upenn.edu/svn/apidb/EuPathWebSvcCommon/trunk</remote>
        <credentialsId></credentialsId>
        <local>project_home/EuPathWebSvcCommon</local>
        <depthOption>infinity</depthOption>
        <ignoreExternalsOption>false</ignoreExternalsOption>
      </hudson.scm.SubversionSCM_-ModuleLocation>
      <hudson.scm.SubversionSCM_-ModuleLocation>
        <remote>https://www.cbil.upenn.edu/svn/apidb/ApiCommonShared/trunk</remote>
        <credentialsId></credentialsId>
        <local>project_home/ApiCommonShared</local>
        <depthOption>infinity</depthOption>
        <ignoreExternalsOption>false</ignoreExternalsOption>
      </hudson.scm.SubversionSCM_-ModuleLocation>
      <hudson.scm.SubversionSCM_-ModuleLocation>
        <remote>https://www.cbil.upenn.edu/svn/gus/ReFlow/trunk</remote>
        <credentialsId></credentialsId>
        <local>project_home/ReFlow</local>
        <depthOption>infinity</depthOption>
        <ignoreExternalsOption>false</ignoreExternalsOption>
      </hudson.scm.SubversionSCM_-ModuleLocation>
      <hudson.scm.SubversionSCM_-ModuleLocation>
        <remote>https://www.cbil.upenn.edu/svn/gus/FgpUtil/trunk</remote>
        <credentialsId></credentialsId>
        <local>project_home/FgpUtil</local>
        <depthOption>infinity</depthOption>
        <ignoreExternalsOption>false</ignoreExternalsOption>
      </hudson.scm.SubversionSCM_-ModuleLocation>
      <hudson.scm.SubversionSCM_-ModuleLocation>
        <remote>https://www.cbil.upenn.edu/svn/gus/WDK/trunk</remote>
        <credentialsId></credentialsId>
        <local>project_home/WDK</local>
        <depthOption>infinity</depthOption>
        <ignoreExternalsOption>false</ignoreExternalsOption>
      </hudson.scm.SubversionSCM_-ModuleLocation>
      <hudson.scm.SubversionSCM_-ModuleLocation>
        <remote>https://www.cbil.upenn.edu/svn/apidb/EuPathDBIrods/trunk</remote>
        <credentialsId></credentialsId>
        <local>project_home/EuPathDBIrods</local>
        <depthOption>infinity</depthOption>
        <ignoreExternalsOption>false</ignoreExternalsOption>
      </hudson.scm.SubversionSCM_-ModuleLocation>
    </locations>
    <excludedRegions></excludedRegions>
    <includedRegions></includedRegions>
    <excludedUsers></excludedUsers>
    <excludedRevprop></excludedRevprop>
    <excludedCommitMessages></excludedCommitMessages>
    <workspaceUpdater class="hudson.scm.subversion.UpdateUpdater"/>
    <ignoreDirPropChanges>false</ignoreDirPropChanges>
    <filterChangelog>false</filterChangelog>
  </scm>
  <assignedNode>irods</assignedNode>
  <canRoam>false</canRoam>
  <disabled>false</disabled>
  <blockBuildWhenDownstreamBuilding>false</blockBuildWhenDownstreamBuilding>
  <blockBuildWhenUpstreamBuilding>false</blockBuildWhenUpstreamBuilding>
  <triggers/>
  <concurrentBuild>false</concurrentBuild>
  <builders>
    <hudson.tasks.Shell>
      <command>#Note that this build cannot put IRODS dependencies in place.  That should be handled separately.

# Setup env variables for this build step
export BASE_GUS=$WORKSPACE
export GUS_HOME=$BASE_GUS/gus_home
export PROJECT_HOME=$BASE_GUS/project_home
export MVN_HOME=/usr/java/maven-3.3.3
export PATH=$GUS_HOME/bin:$PROJECT_HOME/install/bin:$MVN_HOME/bin:$PATH
export PERL5LIB=$GUS_HOME/lib/perl
export M2_REPO=$PROJECT_HOME/.m2_repository 

mkdir -p gus_home

mkdir -p $GUS_HOME/lib/java/db_driver;

cp $ORACLE_HOME/jdbc/lib/ojdbc6.jar $GUS_HOME/lib/java/db_driver/

# ApiCommonData build, upon which EuPathDBIrods depends, requires this file.
mkdir -p $GUS_HOME/config
cp $BASE_GUS/gus.config $GUS_HOME/config/gus.config

# Contains all the project dependencies
bld EuPathDBIrods

# There will be multiple calls here - a different yaml for each project
# Directory named after project made user $GUS_HOME/config when eupathSiteConfigure is run.
apiTnsSummary | grep -v amaz-rbld | grep -v pris-rbld | eupathCloneMetaFile $BASE_GUS/PlasmoDBMetaConfig.yaml

# By convention, all meta config yaml files have this file name suffix.  The prefix is the
# project id.  Run eupathSiteConfigure for each project in the projectList.txt file.
FILE_SUFFIX=&quot;MetaConfig.yaml&quot;
PROJECTS=$(cat projectList.txt | cut -f 2)
for PROJECT in $PROJECTS
do
  eupathSiteConfigure -model $PROJECT -filename $PROJECT$FILE_SUFFIX
done


# Needed for ApiCommonData build upon which EuPathDBIrods depends
# Note that these steps follow the eupathSiteConfigure cmd because they require the dir
# that eupathSiteConfigure creates.
eupathCloneGusConfigFile gus.config -inc projectList.txt


# This builds and places the jenkinsCommunicationConfig.txt file used by IRODS to call
# Jenkins IRODS Listener job
PROJECT_LIST=$(echo $PROJECTS | sed -e &apos;s/ /,/g&apos;)
fgpJava org.apidb.irods.BuildJenkinsCommunicationFile -u $JENKINS_USERNAME -p &quot;be4797e4b88200492d29cf0aeb32f5de&quot; -j http://wij.vm:9171/job/IrodsListener/buildWithParameters -t eupathdbirods -l $PROJECT_LIST</command>
    </hudson.tasks.Shell>
  </builders>
  <publishers/>
  <buildWrappers>
    <org.jenkinsci.plugins.preSCMbuildstep.PreSCMBuildStepsWrapper plugin="preSCMbuildstep@0.3">
      <buildSteps>
        <hudson.tasks.Shell>
          <command># Setup env variables for this build step
export BASE_GUS=$WORKSPACE
export GUS_HOME=$BASE_GUS/gus_home
export PROJECT_HOME=$BASE_GUS/project_home

# Unless this build is run in development mode, completely remove
# gus/project homes in this workspace.  Leaving the templates at
# the top level of the worksapce intact for now.
if [[ $MODE != &quot;Dev&quot; ]]
 then
  if [ -d &quot;$PROJECT_HOME&quot; ]
   then
    rm -rf $PROJECT_HOME
    echo &quot;Removed project home.&quot;
  fi  
  if [ -d &quot;$GUS_HOME&quot; ]
   then
    rm -rf $GUS_HOME
    echo &quot;Removed gus home.&quot;
  fi
fi</command>
        </hudson.tasks.Shell>
      </buildSteps>
      <failOnError>false</failOnError>
    </org.jenkinsci.plugins.preSCMbuildstep.PreSCMBuildStepsWrapper>
  </buildWrappers>
</project>